# Lecture Assist 异步转录功能使用说明

## 功能概述

Lecture Assist 现在支持两种转录模式：
1. **实时转录** - 原有的实时流式转录功能
2. **异步转录** - 新增的文件上传异步转录功能

## 异步转录功能特点

- 支持上传音频文件进行转录
- 支持多种音频格式：MP3, WAV, M4A, WEBM, OGG 等
- 实时显示转录进度
- 自动分离日语原文和中文翻译
- 支持说话人识别
- 本地存储，数据安全

## 使用方法

### 1. 启动服务器

```bash
cd server
pnpm install  # 安装新依赖
pnpm dev
```

### 2. 访问应用

- **Next.js 前端**: http://localhost:4300
- **简单测试页面**: http://localhost:4350

### 3. 使用异步转录

1. 在界面上选择"异步转录"模式
2. 点击"📁 选择音频文件"按钮
3. 选择要转录的音频文件
4. 等待上传和转录完成
5. 查看日语原文和中文翻译结果

## API 接口

### 上传音频文件
```
POST /api/upload
Content-Type: multipart/form-data

参数:
- audio: 音频文件
```

### 查询转录状态
```
GET /api/status/{jobId}
```

### 获取转录结果
```
GET /api/result/{jobId}
```

## 技术实现

### 服务器端
- 使用 multer 处理文件上传
- 集成 Soniox Files API 和 Transcriptions API
- 实现异步任务状态管理
- 支持进度轮询和结果获取

### 前端
- 模式切换界面
- 文件上传组件
- 实时进度显示
- 结果展示区域

## 配置说明

异步转录使用以下配置：
- 模型: `stt-async-preview`
- 语言提示: 日语 (ja)
- 目标翻译语言: 中文 (zh)
- 启用语言识别和说话人分离

## 注意事项

1. 确保 Soniox API Key 已正确配置
2. 音频文件大小建议不超过 100MB
3. 转录时间取决于音频长度，通常为音频长度的 1/10 到 1/5
4. 转录结果会保存在本地存储目录中

## 故障排除

### 上传失败
- 检查文件格式是否支持
- 确认文件大小是否过大
- 检查网络连接

### 转录失败
- 检查 Soniox API Key 是否有效
- 确认音频文件质量
- 查看服务器日志获取详细错误信息

### 进度卡住
- 刷新页面重新开始
- 检查服务器状态
- 查看控制台错误信息
